# TX2にYDLiDAR

## Build

```
$ cd ~/catkin_ws/src
$ git clone https://github.com/EAIBOT/ydlidar.git
$ cd ~/catkin_ws
```
 scan_msg.scan_time, scan_msg.time_incrementのフォーマットが合っていないようなので、YDLiDARのIssue[https://github.com/EAIBOT/ydlidar/issues/14](https://github.com/EAIBOT/ydlidar/issues/14)にあがっている修正を実施する。

/catkin_ws/src/ydlidar/src/ydlidar_node.cpp
```c hl_lines="15 16"
...
     while (ros::ok()) {
        bool hardError;
        LaserScan scan;//原始激光数据
        if(laser.doProcessSimple(scan, hardError )){
            sensor_msgs::LaserScan scan_msg;
            ros::Time start_scan_time;
            start_scan_time.sec = scan.system_time_stamp/1000000000ul;
            start_scan_time.nsec = scan.system_time_stamp%1000000000ul;
            scan_msg.header.stamp = start_scan_time;
            scan_msg.header.frame_id = frame_id;
            scan_msg.angle_min = scan.config.min_angle;
            scan_msg.angle_max = scan.config.max_angle;
            scan_msg.angle_increment = scan.config.ang_increment;
            scan_msg.scan_time = scan.config.scan_time/1000000000.0;
            scan_msg.time_increment = scan.config.time_increment/1000000000.0;
            scan_msg.range_min = scan.config.min_range;
            scan_msg.range_max = scan.config.max_range;
            
            scan_msg.ranges = scan.ranges;
            scan_msg.intensities =  scan.intensities;
            scan_pub.publish(scan_msg);
        }  
        rate.sleep();
        ros::spinOnce();
    }
...
```

Build
```
$ cd ~/catkin_ws
$ catkin_make_isolated --install --use-ninja
```

## udev

```
$ cd ~/ros_catkin_ws/src/ydlidar/startup
$ chmod 777 *
$ sudo sh initenv.sh
```