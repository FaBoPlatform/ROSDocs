# TX2にYDLiDAR

## Build

```
cd ~/catkin_ws/src
git clone https://github.com/EAIBOT/ydlidar.git
cd ..
```
scan_msg.scan_time, scan_msg.time_incrementのフォーマットが合っていないようなので、YDLiDARのIssue[https://github.com/EAIBOT/ydlidar/issues/14](https://github.com/EAIBOT/ydlidar/issues/14)にあがっている修正を実施する。

```
vi ~/catkin_ws/src/ydlidar/src/ydlidar_node.cpp<br>
```
diffコマンドの結果:<br>
```
diff -u ~/catkin_ws/src/ydlidar/src/ydlidar_node.cpp.org ~/catkin_ws/src/ydlidar/src/ydlidar_node.cpp
--- /home/ubuntu/catkin_ws/src/ydlidar/src/ydlidar_node.cpp.org	2019-04-17 11:52:17.775006029 +0900
+++ /home/ubuntu/catkin_ws/src/ydlidar/src/ydlidar_node.cpp	2019-04-17 11:52:32.206993273 +0900
@@ -131,8 +131,8 @@
             scan_msg.angle_min = scan.config.min_angle;
             scan_msg.angle_max = scan.config.max_angle;
             scan_msg.angle_increment = scan.config.ang_increment;
-            scan_msg.scan_time = scan.config.scan_time;
-            scan_msg.time_increment = scan.config.time_increment;
+            scan_msg.scan_time = scan.config.scan_time/1000000000.0;
+            scan_msg.time_increment = scan.config.time_increment/1000000000.0;
             scan_msg.range_min = scan.config.min_range;
             scan_msg.range_max = scan.config.max_range;
```

lidar.launchを編集<br>
```
vi ~/catkin_ws/src/ydlidar/launch/lidar.launch
```
```
--- /home/ubuntu/catkin_ws/src/ydlidar/launch/lidar.launch.org	2019-04-17 13:59:25.209638390 +0900
+++ /home/ubuntu/catkin_ws/src/ydlidar/launch/lidar.launch	2019-04-17 14:54:00.263965585 +0900
@@ -9,12 +9,12 @@
     <param name="reversion"    type="bool"   value="false"/>
     <param name="angle_min"    type="double" value="-180" />
     <param name="angle_max"    type="double" value="180" />
-    <param name="range_min"    type="double" value="0.1" />
+    <param name="range_min"    type="double" value="0.08" />
     <param name="range_max"    type="double" value="16.0" />
     <param name="ignore_array" type="string" value="" />
     <param name="samp_rate"    type="int"    value="9"/>
-    <param name="frequency"    type="double" value="7"/>
+    <param name="frequency"    type="double" value="15"/>
   </node>
-  <node pkg="tf" type="static_transform_publisher" name="base_link_to_laser4"
-    args="0.2245 0.0 0.2 0.0 0.0  0.0 /base_footprint /laser_frame 40" />
+  <node pkg="tf" type="static_transform_publisher" name="base_to_laser"
+    args="0.0 0.0 0.18 0.0 0.0  0.0 /base_link /laser_frame 100" />
 </launch>
```

Build
```
cd ~/catkin_ws
catkin_make_isolated --install --use-ninja
```

## Add device configration

```
sudo ~/catkin_ws/src/ydlidar/startup/initenv.sh
```

## Install YDLIDAR Cartographer-ROS
Cartographerで使えるようにするためのパラメータファイルをインストールします。<br>
```
mkdir ~/github
cd ~/github
git clone https://github.com/FaBoPlatform/YDLIDAR-Cartographer-ROS

cd YDLIDAR-Cartographer-ROS/parameters/
sudo cp *.launch /opt/ros/melodic/share/cartographer_ros/launch/
sudo cp *.lua /opt/ros/melodic/share/cartographer_ros/configuration_files/
```
