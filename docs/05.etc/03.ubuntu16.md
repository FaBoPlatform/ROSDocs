# Ubuntu 16.04にROSを構築

## Dockerの起動

##  設定

```
FROM ros:melodic

RUN apt-get update \
  && apt-get install -y ros-melodic-desktop \
    && rm -rf /var/lib/apt/lists/ \
```

```
docker build -t ros-cartographer .
```

```
open -a Xqurtz
ip=$(ifconfig en0 | grep inet | awk '$1=="inet" {print $2}')
echo $ip
xhost + $ip
```

```
docker run -it -e DISPLAY=$ip:0 --name ros-test ros-cartographer
```

```
docker exec -it ros-cartographer bin/bash
```

Rosdepの初期化
```
$ rosdep init 
$ rosdep update
```

Catkin Workspaceの作成
```
$ apt-get update
$ apt-get install cmake python-catkin-pkg python-empy python-nose python-setuptools libgtest-dev python-rosinstall python-rosinstall-generator python-wstool build-essential git
$ mkdir -p ~/catkin_ws/src 
$ cd ~/catkin_ws/
$ catkin_make
```

環境編数に登録
```
$ echo "source ~/catkin_ws/devel/setup.bash" >> ~/.bashrc 
$ source ~/.bashrc
```

## Cartographerをインストール

```
$ apt install ros-melodic-cartographer-ros
```

```
$ apt-get install ninja-build libceres-dev libprotobuf-dev protobuf-compiler libprotoc-dev
$ cd ~/catkin_ws/src
$ git clone https://github.com/googlecartographer/cartographer.git
$ git clone https://github.com/googlecartographer/cartographer_ros.git
$ cd ~/catkin_ws
$ src/cartographer/scripts/install_proto3.sh
$ rm -rf protobuf/
$ rosdep install --from-paths src --ignore-src -r -y --os=ubuntu:xenial
$ catkin_make_isolated --install --use-ninja
```

```
$ cd ~/catkin_ws/src/cartographer_ros/cartographer_ros/launch/
$ vim backpack_2d.launch
```

```
<!--
  Copyright 2016 The Cartographer Authors

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<launch>
  <param name="robot_description"
    textfile="$(find cartographer_ros)/urdf/backpack_2d.urdf" />
  <node
      name="rviz"
      pkg="rviz"
      type="rviz"
      required="true"
      args="-d $(find cartographer_ros)/configuration_files/demo_2d.rviz"
  />

</launch>
```

```
$ cd ~/catkin_ws
$ catkin_make_isolated --install --use-ninja
$ source install_isolated/setup.bash
```

エラーがでる
```
QStandardPaths: XDG_RUNTIME_DIR not set, defaulting to '/tmp/runtime-root'
libGL error: No matching fbConfigs or visuals found
libGL error: failed to load driver: swrast
libGL error: No matching fbConfigs or visuals found
libGL error: failed to load driver: swrast
libGL error: No matching fbConfigs or visuals found
libGL error: failed to load driver: swrast
rviz: /build/ogre-1.9-B6QkmW/ogre-1.9-1.9.0+dfsg1/RenderSystems/GL/src/OgreGLSupport.cpp:56: virtual void Ogre::GLSupport::initialiseExtensions(): Assertion `pcVer && "Problems getting GL version string using glGetString"' failed.
================================================================================REQUIRED process [rviz-2] has died!
process has died [pid 10453, exit code -6, cmd /opt/ros/melodic/lib/rviz/rviz -d /root/catkin_ws/install_isolated/share/cartographer_ros/configuration_files/demo_2d.rviz __name:=rviz __log:=/root/.ros/log/8bb415ce-5c0d-11e9-9055-0242ac110004/rviz-2.log].
log file: /root/.ros/log/8bb415ce-5c0d-11e9-9055-0242ac110004/rviz-2*.log
Initiating shutdown!
================================================================================
[rviz-2] killing on exit
[rosout-1] killing on exit
[master] killing on exit
shutting down processing monitor...
... shutting down processing monitor complete
done
```